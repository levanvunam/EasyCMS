tinymce.PluginManager.add("mediaBrowser",function(n){function t(t){return function(){var i=n.settings.image_list;typeof i=="string"?tinymce.util.XHR.send({url:i,success:function(n){t(tinymce.util.JSON.parse(n))}}):t(i)}}function i(t){function v(){var n=[{text:"None",value:""}];return tinymce.each(t,function(t){n.push({text:t.text||t.title,value:t.value||t.url,menu:t.menu})}),n}function l(n){var r,f,t,i;r=u.find("#width")[0];f=u.find("#height")[0];t=r.value();i=f.value();u.find("#constrain")[0].checked()&&e&&o&&t&&i&&(n.control==r?(i=Math.round(t/e*i),f.value(i)):(t=Math.round(i/o*t),r.value(t)));e=t;o=i}function a(){function f(t){t.onload=t.onerror=function(){t.onload=t.onerror=null;n.selection.select(t);n.nodeChanged()}}var t=u.toJSON();t.width===""&&(t.width=null);t.height===""&&(t.height=null);t.style===""&&(t.style=null);t={src:t.src,alt:t.alt,width:t.width,height:t.height,style:t.style};i?r.setAttribs(i,t):(t.id="__mcenew",n.insertContent(r.createHTML("img",t)),i=r.get("__mcenew"),r.setAttrib(i,"id",null));f(i)}function s(n){return n&&(n=n.replace(/px$/,"")),n}function y(){var n=u.find("#src")[0];window.openMediaBrowser&&window.openMediaBrowser(function(t){n.value(t)})}function p(){function i(n){return n.length>0&&/^[0-9]+$/.test(n)&&(n+="px"),n}var t=u.toJSON(),n=r.parseStyle(t.style);delete n.margin;n["margin-top"]=n["margin-bottom"]=i(t.vspace);n["margin-left"]=n["margin-right"]=i(t.hspace);n["border-width"]=i(t.border);u.find("#style").value(r.serializeStyle(r.parseStyle(r.serializeStyle(n))))}var u,f,r=n.dom,i=n.selection.getNode(),e,o,c,h;e=r.getAttrib(i,"width");o=r.getAttrib(i,"height");i.nodeName!="IMG"||i.getAttribute("data-mce-object")?i=null:f={src:r.getAttrib(i,"src"),alt:r.getAttrib(i,"alt"),width:e,height:o};t&&(c={name:"target",type:"listbox",label:"Image list",values:v(),onselect:function(n){var t=u.find("#alt");(!t.value()||n.lastControl&&t.value()==n.lastControl.text())&&t.value(n.control.text());u.find("#src").value(n.control.value())}});h=[{type:"container",label:"Image Url",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"src",type:"textbox",filetype:"image",size:10,label:"Source",autofocus:!0},{name:"btnBrowse",type:"button",text:"Select",autofocus:!0,onClick:y},]},c,{name:"alt",type:"textbox",label:"Image description"},{type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:3,size:3,onchange:l},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:3,size:3,onchange:l},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}];n.settings.image_advtab?(i&&(f.hspace=s(i.style.marginLeft||i.style.marginRight),f.vspace=s(i.style.marginTop||i.style.marginBottom),f.border=s(i.style.borderWidth),f.style=n.dom.serializeStyle(n.dom.parseStyle(n.dom.getAttrib(i,"style")))),u=n.windowManager.open({title:"Edit image",data:f,bodyType:"tabpanel",body:[{title:"General",type:"form",items:h},{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox"},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:p},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}],onSubmit:a})):u=n.windowManager.open({title:"Edit image",data:f,body:h,onSubmit:a})}n.addButton("mediaBrowser",{icon:"image",tooltip:"Insert/Edit image",onclick:t(i),stateSelector:"img:not([data-mce-object])"});n.addMenuItem("mediaBrowser",{icon:"image",text:"Select/Insert image",onclick:t(i),context:"insert",prependToContext:!0})});
/*
//# sourceMappingURL=plugin.min.js.map
*/